<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwecto - Smart Loan Platform</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* Smoother scrolling and font setup */
        body { font-family: 'Segoe UI', sans-serif; background-color: #E0E5EC; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- 1. ICONS (Recreated manually to avoid import errors) ---
        const Icon = ({ d, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d={d} />
            </svg>
        );
        // Specific Icons
        const CalculatorIcon = (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const CalendarIcon = (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;
        const TargetIcon = (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>;
        const DownloadIcon = (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const FileTextIcon = (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>;
        const ClockIcon = (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const ArrowIcon = (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 3 4 4-4 4"/><path d="M20 7H4"/><path d="m8 21-4-4 4-4"/><path d="M4 17h16"/></svg>;

        // --- 2. FORMATTING UTILS ---
        const formatCurrency = (val) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(val);
        const formatFullNumber = (num) => new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 }).format(num);
        const amountToWords = (num) => {
            if (!num || num === 0) return '';
            const a = ['','One ','Two ','Three ','Four ', 'Five ','Six ','Seven ','Eight ','Nine ','Ten ','Eleven ','Twelve ','Thirteen ','Fourteen ','Fifteen ','Sixteen ','Seventeen ','Eighteen ','Nineteen '];
            const b = ['', '', 'Twenty','Thirty','Forty','Fifty', 'Sixty','Seventy','Eighty','Ninety'];
            const inWords = (n) => {
                if ((n = n.toString()).length > 9) return 'overflow';
                let n_array = ('000000000' + n).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
                if (!n_array) return; 
                let str = '';
                str += (n_array[1] != 0) ? (a[Number(n_array[1])] || b[n_array[1][0]] + ' ' + a[n_array[1][1]]) + 'Crore ' : '';
                str += (n_array[2] != 0) ? (a[Number(n_array[2])] || b[n_array[2][0]] + ' ' + a[n_array[2][1]]) + 'Lakh ' : '';
                str += (n_array[3] != 0) ? (a[Number(n_array[3])] || b[n_array[3][0]] + ' ' + a[n_array[3][1]]) + 'Thousand ' : '';
                str += (n_array[4] != 0) ? (a[Number(n_array[4])] || b[n_array[4][0]] + ' ' + a[n_array[4][1]]) + 'Hundred ' : '';
                str += (n_array[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n_array[5])] || b[n_array[5][0]] + ' ' + a[n_array[5][1]]) : '';
                return str;
            };
            return inWords(Math.floor(num));
        };

        // --- 3. UI COMPONENTS (Neumorphic Style) ---
        const NeumorphicCard = ({ children, className = "" }) => (
            <div className={`bg-[#E0E5EC] rounded-[30px] shadow-[9px_9px_16px_rgb(163,177,198,0.6),-9px_-9px_16px_rgba(255,255,255,0.5)] ${className}`}>
                {children}
            </div>
        );

        const NeumorphicInput = ({ label, value, onChange, type = "number", prefix, suffix, isCalculated = false, helperText }) => (
            <div className="mb-6">
                <div className="flex justify-between mb-2 px-1">
                    <label className={`text-xs font-bold tracking-wider uppercase ${isCalculated ? 'text-emerald-500' : 'text-slate-500'}`}>
                        {label} {isCalculated && "(Auto)"}
                    </label>
                </div>
                <div className={`relative flex items-center rounded-2xl px-4 py-3 transition-all ${isCalculated ? 'bg-[#E0E5EC] shadow-[5px_5px_10px_#b8b9be,-5px_-5px_10px_#ffffff] border border-emerald-100/50' : 'bg-[#E0E5EC] shadow-[inset_6px_6px_10px_0_rgba(163,177,198,0.7),inset_-6px_-6px_10px_0_rgba(255,255,255,0.8)]'}`}>
                    {prefix && <span className="text-slate-400 mr-2 font-medium">{prefix}</span>}
                    <input type={type} value={value} onChange={(e) => !isCalculated && onChange(e.target.value)} readOnly={isCalculated} className={`w-full bg-transparent outline-none text-lg font-bold text-slate-700 placeholder-slate-300 ${isCalculated ? 'cursor-default text-emerald-600' : ''}`} />
                    {suffix && <span className="text-slate-400 ml-2 text-sm font-medium">{suffix}</span>}
                </div>
                {helperText && <p className="text-[10px] font-semibold text-emerald-600/70 mt-2 ml-2 tracking-wide h-3 leading-none truncate">{helperText}</p>}
            </div>
        );

        const NeumorphicButton = ({ children, onClick, className = "" }) => (
            <button onClick={onClick} className={`w-full py-4 rounded-2xl font-bold text-white shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff] bg-gradient-to-r from-emerald-400 to-teal-500 hover:from-emerald-500 hover:to-teal-600 transform active:scale-95 transition-all duration-200 flex items-center justify-center gap-2 ${className}`}>
                {children}
            </button>
        );

        // --- 4. MAIN APP LOGIC ---
        function App() {
            const [values, setValues] = useState({ principal: 5000000, rate: 8.5, tenure: 20, emi: 0 });
            const [activeTab, setActiveTab] = useState('calculator');
            const [extraEMI, setExtraEMI] = useState(5000);
            const [sipReturnRate, setSipReturnRate] = useState(12);

            // Calculations
            const data = useMemo(() => {
                const P = parseFloat(values.principal) || 0;
                const R = parseFloat(values.rate) || 0;
                const N = parseFloat(values.tenure) || 0;
                
                if(P===0 || R===0 || N===0) return null;

                const r = R / 12 / 100;
                const months = N * 12;
                const emi = P * r * (Math.pow(1 + r, months) / (Math.pow(1 + r, months) - 1));
                const totalPay = emi * months;
                const totalInt = totalPay - P;

                // Generate Schedule
                let balance = P;
                const schedule = [];
                for(let i=1; i<=months; i++){
                    let intComp = balance * r;
                    let prinComp = emi - intComp;
                    balance -= prinComp;
                    if(balance < 0) balance = 0;
                    schedule.push({ month: i, principal: prinComp, interest: intComp, balance: balance, emi: emi });
                    if(balance === 0) break;
                }

                return { emi, totalPay, totalInt, schedule, months };
            }, [values]);

            // Smart Repay Analysis
            const analysis = useMemo(() => {
                if(!data || !extraEMI) return null;
                const sipRate = (sipReturnRate / 12) / 100;
                let foreclosureMonth = null;
                
                // Check when SIP value > Loan Balance
                for(let row of data.schedule) {
                    // SIP Value formula: P * ((1+i)^n - 1)/i * (1+i)
                    let sipValue = parseFloat(extraEMI) * ((Math.pow(1 + sipRate, row.month) - 1) / sipRate) * (1 + sipRate);
                    if(sipValue >= row.balance) {
                        foreclosureMonth = row.month;
                        break;
                    }
                }

                const duration = foreclosureMonth || data.months;
                const sipMaturity = parseFloat(extraEMI) * ((Math.pow(1 + sipRate, duration) - 1) / sipRate) * (1 + sipRate);
                const invested = parseFloat(extraEMI) * duration;
                
                return { foreclosureMonth, sipMaturity, invested, profit: sipMaturity - invested };
            }, [data, extraEMI, sipReturnRate]);

            // --- DOWNLOAD HANDLERS ---
            const downloadCSV = () => {
                if (!data) return;
                const headers = ["Month", "EMI", "Principal", "Interest", "Balance"];
                const rows = data.schedule.map(r => [r.month, r.emi.toFixed(0), r.principal.toFixed(0), r.interest.toFixed(0), r.balance.toFixed(0)].join(","));
                const csv = "data:text/csv;charset=utf-8," + [headers.join(","), ...rows].join("\n");
                const link = document.createElement("a");
                link.href = encodeURI(csv);
                link.download = "qwecto_schedule.csv";
                link.click();
            };

            const downloadPDF = () => {
                if(!data || !window.jspdf) return;
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.setFillColor(16, 185, 129);
                doc.rect(0,0,210,40,'F');
                doc.setTextColor(255,255,255);
                doc.setFontSize(22);
                doc.text("Qwecto", 14, 25);
                doc.setFontSize(12);
                doc.text("Loan Schedule", 14, 33);
                
                const rows = data.schedule.filter((_, i) => (i+1)%12 === 0 || i === data.schedule.length-1).map(r => [
                    `Year ${Math.ceil(r.month/12)}`, 
                    formatFullNumber(r.emi * 12), 
                    formatFullNumber(r.balance)
                ]);

                doc.autoTable({
                    head: [['Period', 'Total Paid (Year)', 'Balance']],
                    body: rows,
                    startY: 50,
                });
                doc.save("Qwecto_Report.pdf");
            };

            return (
                <div className="min-h-screen bg-[#E0E5EC] text-slate-600 font-sans flex items-center justify-center p-4 md:p-8">
                    <div className="w-full max-w-5xl">
                        
                        {/* HEADER */}
                        <div className="flex justify-between items-center mb-8 px-4">
                            <h1 className="text-2xl font-bold text-slate-700 flex items-center gap-2">
                                <div className="p-2 rounded-lg bg-[#E0E5EC] shadow-[4px_4px_8px_#b8b9be,-4px_-4px_8px_#ffffff]">
                                    <div className="text-emerald-500 font-bold">Q</div>
                                </div>
                                Qwecto
                            </h1>
                            {/* TABS */}
                            <div className="flex bg-[#E0E5EC] rounded-2xl p-1.5 shadow-[inset_4px_4px_8px_#b8b9be,inset_-4px_-4px_8px_#ffffff]">
                                {[
                                    { id: 'calculator', label: 'Loan', icon: CalculatorIcon },
                                    { id: 'schedule', label: 'Schedule', icon: CalendarIcon },
                                    { id: 'smartRepay', label: 'Smart Repay', icon: TargetIcon }
                                ].map(tab => (
                                    <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-bold uppercase transition-all duration-300 ${activeTab === tab.id ? 'bg-[#E0E5EC] text-emerald-500 shadow-[4px_4px_8px_#b8b9be,-4px_-4px_8px_#ffffff]' : 'text-slate-400 hover:text-slate-500'}`}>
                                        <tab.icon className="w-4 h-4" />
                                        <span className="hidden sm:inline">{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>

                        <NeumorphicCard className="overflow-hidden p-8">
                            
                            {/* TAB: CALCULATOR */}
                            {activeTab === 'calculator' && (
                                <div className="flex flex-col md:flex-row gap-12">
                                    <div className="w-full md:w-1/2">
                                        <NeumorphicInput label="Loan Amount" value={values.principal} onChange={v => setValues({...values, principal: v})} prefix="₹" helperText={amountToWords(values.principal)} />
                                        <NeumorphicInput label="Interest Rate" value={values.rate} onChange={v => setValues({...values, rate: v})} suffix="%" step="0.1" />
                                        <NeumorphicInput label="Tenure (Years)" value={values.tenure} onChange={v => setValues({...values, tenure: v})} />
                                        
                                        <div className="mt-8">
                                            <NeumorphicButton onClick={() => setActiveTab('schedule')}>View Schedule Details</NeumorphicButton>
                                        </div>
                                    </div>
                                    <div className="w-full md:w-1/2 flex flex-col items-center justify-center border-l border-slate-200 pl-8">
                                        <div className="w-56 h-56 rounded-full bg-[#E0E5EC] shadow-[12px_12px_24px_#b8b9be,-12px_-12px_24px_#ffffff] flex items-center justify-center mb-6">
                                            <div className="text-center">
                                                <div className="text-xs font-bold text-slate-400 uppercase">Monthly EMI</div>
                                                <div className="text-3xl font-bold text-emerald-500 mt-2">
                                                    {data ? formatCurrency(data.emi) : '₹0'}
                                                </div>
                                            </div>
                                        </div>
                                        <div className="w-full flex justify-between px-4 text-sm">
                                            <span>Total Interest:</span>
                                            <span className="font-bold text-rose-500">{data ? formatCurrency(data.totalInt) : 0}</span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* TAB: SCHEDULE */}
                            {activeTab === 'schedule' && data && (
                                <div>
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-xl font-bold text-slate-700">Amortization</h2>
                                        <div className="flex gap-4">
                                            <button onClick={downloadCSV} className="flex items-center gap-2 px-4 py-2 text-xs font-bold bg-[#E0E5EC] rounded-xl shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff] text-slate-600"><FileTextIcon className="w-4 h-4"/> CSV</button>
                                            <button onClick={downloadPDF} className="flex items-center gap-2 px-4 py-2 text-xs font-bold bg-[#E0E5EC] rounded-xl shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff] text-slate-600"><DownloadIcon className="w-4 h-4"/> PDF</button>
                                        </div>
                                    </div>
                                    <div className="overflow-auto max-h-[400px] rounded-2xl bg-[#E0E5EC] shadow-[inset_4px_4px_8px_#b8b9be,inset_-4px_-4px_8px_#ffffff] p-4">
                                        <table className="w-full text-sm text-left">
                                            <thead className="text-xs text-slate-400 uppercase border-b border-slate-300">
                                                <tr><th className="p-3">Year</th><th className="p-3">Principal</th><th className="p-3">Interest</th><th className="p-3">Balance</th></tr>
                                            </thead>
                                            <tbody>
                                                {data.schedule.filter((_, i) => (i+1)%12===0 || i===data.schedule.length-1).map(r => (
                                                    <tr key={r.month} className="border-b border-slate-200/50 hover:bg-white/30">
                                                        <td className="p-3 font-bold">Year {Math.ceil(r.month/12)}</td>
                                                        <td className="p-3 text-emerald-600">{formatCurrency(r.principal*12)}</td> 
                                                        <td className="p-3 text-rose-500">{formatCurrency(r.interest*12)}</td>
                                                        <td className="p-3 text-slate-500">{formatCurrency(r.balance)}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* TAB: SMART REPAY */}
                            {activeTab === 'smartRepay' && (
                                <div className="flex flex-col md:flex-row gap-8">
                                    <div className="w-full md:w-1/3 space-y-6">
                                        <h3 className="text-lg font-bold text-slate-700">SIP Strategy</h3>
                                        <NeumorphicInput label="Monthly SIP Amount" value={extraEMI} onChange={setExtraEMI} prefix="₹" />
                                        <NeumorphicInput label="Expected Return" value={sipReturnRate} onChange={setSipReturnRate} suffix="%" />
                                        <div className="p-4 rounded-2xl bg-[#E0E5EC] shadow-[inset_4px_4px_8px_#b8b9be,inset_-4px_-4px_8px_#ffffff] text-xs text-slate-500">
                                            Invest your surplus to close the loan early.
                                        </div>
                                    </div>
                                    <div className="w-full md:w-2/3">
                                        {analysis && analysis.foreclosureMonth ? (
                                            <div className="flex flex-col items-center justify-center h-full text-center space-y-6">
                                                <div className="p-4 rounded-full bg-emerald-100 text-emerald-600 shadow-inner">
                                                    <ClockIcon className="w-8 h-8" />
                                                </div>
                                                <div>
                                                    <h4 className="text-2xl font-bold text-slate-700">Debt Free by Year {(analysis.foreclosureMonth/12).toFixed(1)}</h4>
                                                    <p className="text-sm text-slate-500 mt-2">Your SIP value will cross your loan balance.</p>
                                                </div>
                                                <div className="grid grid-cols-2 gap-4 w-full">
                                                    <div className="p-4 rounded-2xl bg-[#E0E5EC] shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff]">
                                                        <div className="text-xs font-bold text-slate-400 uppercase">Total Invested</div>
                                                        <div className="text-lg font-bold text-slate-700">{formatFullNumber(analysis.invested)}</div>
                                                    </div>
                                                    <div className="p-4 rounded-2xl bg-[#E0E5EC] shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff]">
                                                        <div className="text-xs font-bold text-emerald-500 uppercase">Profit</div>
                                                        <div className="text-lg font-bold text-emerald-600">+{formatFullNumber(analysis.profit)}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="flex items-center justify-center h-full text-slate-400">Enter SIP amount to see analysis</div>
                                        )}
                                    </div>
                                </div>
                            )}

                        </NeumorphicCard>
                    </div>
                </div>
            );
        }

        // Start the App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>